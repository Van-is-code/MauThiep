# Vite Configuration for HTTrack Templates

## Problem
Vite tries to parse HTML files from the `public/templates/` folder, but these files are generated by HTTrack and have malformed HTML structure. This causes parse errors like:

```
Unable to parse HTML; parse5 error code misplaced-start-tag-for-head-element
```

## Solution

### 1. **Vite Plugin Configuration** (`vite.config.ts`)

The configuration includes a custom plugin `rawTemplatesPlugin` that:
- Intercepts requests for template HTML files (`/templates/*.html`)
- Serves them directly without parsing through Vite's HTML transformer
- Bypasses all HTML validation and transformation

```typescript
const rawTemplatesPlugin = {
  name: 'raw-templates',
  configureServer(server) {
    return () => {
      server.middlewares.use((req, res, next) => {
        // Intercept requests for template HTML files
        if (req.url.includes('/templates/') && req.url.endsWith('.html')) {
          // Serve as raw HTML without parsing
          // ...
        }
        next()
      })
    }
  }
}
```

### 2. **Display Templates Safely** (`TemplateViewer.tsx`)

Never embed malformed HTML directly in React. Instead, use iframes:

```tsx
<iframe
  src={template.url}
  title={template.title}
  sandbox="allow-same-origin allow-scripts allow-forms allow-popups"
/>
```

The `TemplateViewer` component provides:
- **TemplateLink** - Direct link to open in new tab
- **TemplateFrame** - Embed in iframe with loading/error handling
- **TemplateModal** - Modal viewer for full-screen preview
- **TemplateCard** - Gallery card component
- **TemplateGallery** - Grid gallery with all cards

### 3. **How It Works**

```
User clicks "View Template"
        ↓
Component opens iframe with URL
        ↓
Request to /templates/T02/invitations.jmiiwedding.com/dohaa.html
        ↓
Vite plugin intercepts request
        ↓
Reads file directly from disk
        ↓
Serves as plain HTML (no parsing)
        ↓
iframe renders the HTML
```

## Usage

### Import Components
```tsx
import { TemplateGallery, TemplateCard, TemplateFrame } from './components/TemplateViewer'
import './styles/TemplateViewer.css'
```

### Full Gallery
```tsx
import { useTemplates } from './hooks/useTemplates'
import { TemplateGallery } from './components/TemplateViewer'

function GalleryPage() {
  const { templates } = useTemplates()
  return <TemplateGallery templates={templates} />
}
```

### Single Template
```tsx
import { TemplateFrame } from './components/TemplateViewer'

function DetailPage({ template }) {
  return <TemplateFrame template={template} />
}
```

### Direct Link
```tsx
import { TemplateLink } from './components/TemplateViewer'

// Just a link
<TemplateLink template={template} />
```

## Development
```bash
npm run dev
# Template files will be served correctly without parsing errors
```

## Production
The plugin only activates in dev mode. In production:
- Static server serves files directly from `/public` folder
- No HTML parsing issues
- iframes load the HTML normally

## Iframe Sandbox Security
```html
<iframe
  sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-presentation"
/>
```

Allows:
- ✅ Scripts to run (needed for interactivity)
- ✅ Forms to work
- ✅ Popups/dialogs
- ✅ Same origin requests

Blocks:
- ❌ External domain navigation
- ❌ Top-level navigation
- ❌ Plugin access
- ❌ Pointer lock

## Benefits

| Benefit | Impact |
|---------|--------|
| **No Parse Errors** | Templates load without compilation errors |
| **Safe Isolation** | Content isolated in iframe sandbox |
| **Works Everywhere** | Same code for dev and production |
| **Easy to Maintain** | Simple configuration, no build step changes |
| **User Friendly** | Smooth preview experience |

## Troubleshooting

### Template still not loading?
1. Check browser console for CORS errors
2. Verify file path in data.json is correct
3. Ensure file exists in `public/templates/` folder

### Iframe shows blank?
1. Open browser DevTools
2. Check Network tab for 404s
3. Check Console for JavaScript errors
4. Try opening URL directly in new tab

### Resources not loading in iframe?
1. Update relative paths to absolute paths
2. Ensure assets are in `public/` folder
3. Update image paths in HTML files

## Files

- `vite.config.ts` - Vite configuration with raw templates plugin
- `src/components/TemplateViewer.tsx` - React components for displaying templates
- `src/styles/TemplateViewer.css` - Styles for template components
- `public/data.json` - Template metadata with correct paths

All set to deploy! ✅
